import java.awt.Color;
import java.awt.Container;
import java.awt.Desktop;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.io.ObjectInputStream;
import java.net.ServerSocket;
import java.net.Socket;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.Statement;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.Iterator;

import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JTextField;

public class EndUser implements ActionListener 
{
	JFrame jf;
	Container c;
	JPanel p1,p2;	
	JLabel l1,l2,img,l5;
	JTextField t1,t2,t3;
	JButton b1,b2,b3,b4;
	int rank; 
	JLabel mg1, mg2, mg3, mg4, mg5, mg6, mg7, mg8, mg9, mg10, g11, g22, g33,g44, g55, g66, g77,l8,l9;
	ImageIcon banner;
	
	
	@SuppressWarnings("deprecation")
	EndUser()
	{
		jf = new JFrame("End User::");
		c = jf.getContentPane();
		c.setLayout(null);
		c.setBackground(Color.WHITE);

		
		ImageIcon banner = new ImageIcon(this.getClass().getResource("images/enduser.png"));
		JLabel l5 = new JLabel();
		l5.setIcon(banner);
		l5.setBounds(0, 0,  700,540);
		
		b2 = new JButton("Download");
		b2.setBounds(60, 300, 100, 30);
		b2.addActionListener(this);
		
		c.add(b2);
		c.add(l5);
		jf.setSize(700,575);
		jf.show();
		
	}
	
	public void actionPerformed(ActionEvent e1)
	{
		Object o = e1.getSource();
		
		if(o == b2)
		{
						
			 String fname = JOptionPane.showInputDialog(null, "Enter FileName");
			 String uname = JOptionPane.showInputDialog(null, "Enter Username");
			 String sk = JOptionPane.showInputDialog(null, "Enter Secret Key");
			 String ip = JOptionPane.showInputDialog(null, "Enter Cloud IP Address");
			 try
			 {
				 Socket cn2 = new Socket(ip,1001);
				  DataOutputStream oos2 = new DataOutputStream(cn2.getOutputStream());
				  oos2.writeUTF("Request");
				  oos2.writeUTF(fname);
				  oos2.writeUTF(uname);
				  oos2.writeUTF(sk);
				  
				  DataInputStream ois2 = new DataInputStream(cn2.getInputStream());
				  String result = (String)ois2.readUTF();
				  String filename = (String) ois2.readUTF();
				  String ct = (String) ois2.readUTF();
				  if(result.equals("Valid"))
				  {
					
						  FileOutputStream fos = new FileOutputStream("User/"+ filename);
						  fos.write(ct.getBytes());
						  System.out.println("Received Successfully");
						  
						  JOptionPane.showMessageDialog(null, "File Downloaded Successfully");
						  int option = JOptionPane.showConfirmDialog(null, "Do You Want To Open The File Folder");
						  if(option==0)
						  {
							  File f1 = new File("User");
							  Desktop d1 = Desktop.getDesktop();
							  d1.open(f1);
						  }
						  else if(option==1)
						  {
							 
						  }
				  }   
				  
				  if(result.equals("hacker"))
				  {
					  JOptionPane.showMessageDialog(null, "You Are a Hacker !!! Pls Enter Correct Secret Key or FileName");
				  }	
				  if(result.equals("wuser"))
				  {
					  JOptionPane.showMessageDialog(null, "Your Are a Hacker !!! Pls Enter Correct Username");
				  }	
				  
			 }catch(Exception e2)
			 {
				 e2.printStackTrace();
			 }
		}
			
			
		}
		
		
	public static void main(String[] args) {
		 new EndUser();
		 
	}
}