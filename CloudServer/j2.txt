
			while (rs.next()) {
				Vector row = new Vector();
				for (int i = 1; i <= col; i++) {
					row.addElement(rs.getObject(i));

				}

				data.addElement(row);
			}

			JTable table = new JTable(data, heading);

			JScrollPane pane = new JScrollPane(table);

			pane.setBounds(50,100,650,250);
			c.add(pane);

		} catch (Exception ex) {
			ex.printStackTrace();
	}
		}
		if (o == item2) {
			
			try{
				Dbcon db=new Dbcon();
				Connection con = db.getConnection();
				Statement stmt = con.createStatement();
				
				String owner = JOptionPane.showInputDialog(null, "Enter Data Creator");
				String assign = JOptionPane.showInputDialog(null, "Enter Number Of Tasks");
				
				int task=0;
				String query = "insert into koutn values('"+owner+"','" +assign+ "','" +task+ "')";	
				stmt.executeUpdate(query);
				
				JOptionPane.showMessageDialog(null, "Tasks Assigned Successfully");
				
				}catch (Exception e5) {
					// TODO: handle exception
				}
			}
			

		if (o == users) {
			
			ViewAttacker v =new ViewAttacker();
			v.setSize(500, 500);
			v.setVisible(true);
		}
		
		if(o == exit)
		{
			System.exit(0);
		}
	}

	class PortListener implements Runnable {
		
		int port;

		public PortListener(int port) {
			this.port = port;
		}

		public void run() {
			try{
			Class.forName("sun.jdbc.odbc.JdbcOdbcDriver");
			Dbcon db=new Dbcon();
			Connection connect=db.getConnection();
			connect = DriverManager.getConnection("jdbc:odbc:K-anonimity");
			
			 
		 if (this.port == 2424) {
			 
				try {
					ServerSocket sc01, sc02, sc03, sc04, sc11, sc12;
					Socket cn01, cn02, cn03, cn04, cn05, cn1, cn2;
					
					sc02 = new ServerSocket(2424);

						String oname,filename,sk,ct;
						String sp1,sp2,sp3,sp4,sp5;
						String h1,h2,h3,h4,h5;
						String tym;
						
					while (true) {
						cn02 = sc02.accept();
						
						
						Statement stmt = connect.createStatement();
						DataInputStream dis = new DataInputStream(cn02.getInputStream());
						
						oname	= dis.readUTF();
						filename	= dis.readUTF();
						sk		= dis.readUTF();
						ct=dis.readUTF();
					
						sp1 = dis.readUTF();
						sp2 = dis.readUTF();
						sp3 = dis.readUTF();
						sp4 = dis.readUTF();
						sp5 = dis.readUTF();

						
						h1 = dis.readUTF();
						h2 = dis.readUTF();
						h3 = dis.readUTF();
						h4 = dis.readUTF();
						h5 = dis.readUTF();
						tym = dis.readUTF();

						
						 int len = filename.length();
						 String fname = filename.substring(0, len-5);
						
							
							
							String query = "insert into cloudfiles values('"+oname+"','" +fname+ "','" +sk+ "','"+h1+"','"+h2+"','"+h3+"','"+h4+"','"+h5+"','"+tym+"')";	
							stmt.executeUpdate(query);
				
	
							PrintStream out99 = null;
							try {
							    out99 = new PrintStream(new FileOutputStream("CloudServer\\"+fname+".txt"));
							    out99.print(ct);
							    
							    
							}
							finally {
							    if (out99 != null) out99.close();
							}
							
							PrintStream out = null;
							try {
							    out = new PrintStream(new FileOutputStream("CloudServer\\"+fname+"1"+".txt"));
							    out.print(sp1);
							    
							    
							}
							finally {
							    if (out != null) out.close();
							}
							
							PrintStream out1 = null;
							try {
							    out1 = new PrintStream(new FileOutputStream("CloudServer\\"+fname+"2"+".txt"));
							    out1.print(sp2);
							    
							}
							finally {
							    if (out1 != null) out1.close();
							}
							
							PrintStream out2 = null;
							try {
							    out2 = new PrintStream(new FileOutputStream("CloudServer\\"+fname+"3"+".txt"));
							    out2.print(sp3);