hooser chooser = new JFileChooser("Database");
			try {
				File f = new File(new File("filename.txt").getCanonicalPath());
				chooser.setSelectedFile(f);
			} catch (IOException e1) {
			}

			int retval = chooser.showOpenDialog(b1);
			if (retval == JFileChooser.APPROVE_OPTION) {
				File field = chooser.getSelectedFile();
				
				path = chooser.getSelectedFile();
			}

			File curFile = chooser.getSelectedFile();
			try {
				FileInputStream fstream = new FileInputStream(curFile);
				DataInputStream ins = new DataInputStream(fstream);
				BufferedReader br = new BufferedReader(new InputStreamReader(
						ins));
				StringBuffer buffer = new StringBuffer();

				while ((strline = br.readLine()) != null) {
					System.out.println(strline);
					buffer.append(strline + "\n");
				}
				ta.setText(buffer.toString());
			} catch (Exception e1) {
				e1.printStackTrace();
			}
		}
		
		if (o == b2) {
			
			long start=System.currentTimeMillis();

			String ip = JOptionPane.showInputDialog(null,"Enter Cloud Server Ip Address");
			String fname = JOptionPane.showInputDialog(null,"Enter the file name");
			try {

				AES enc = new AES();

				KeyPairGenerator kg = KeyPairGenerator.getInstance("RSA");
				encoder = Cipher.getInstance("RSA");
				KeyPair kp = kg.generateKeyPair();

				prKey = kp.getPrivate();
				pubKey = kp.getPublic();

				byte[] pub = pubKey.getEncoded();
				System.out.println("PUBLIC KEY" + pub);
		
				String pk = String.valueOf(pub);

				KeyGenerator2 k = new KeyGenerator2();
				String secretkey = String.valueOf(k.getKeys());
				
				FileInputStream fis = new FileInputStream(path);
				byte b[] = new byte[fis.available()];
				fis.read(b);
				String cont = new String(b);
				System.out.println("Contents are:" + "\t" + cont);
				System.out.println(b);

				Class.forName("sun.jdbc.odbc.JdbcOdbcDriver");
				Connection connect1 = DriverManager.getConnection("jdbc:odbc:K-anonimity");
				
				
				AES a1=new AES();
				String content=a1.encrypt(cont,  keyWord);
				
				System.out.println(content);
				
					PrintStream out = null;
					try {
					    out = new PrintStream(new FileOutputStream("Owner\\"+fname));
					    out.print(content);
					}
					finally {
					    if (out != null) out.close();
					}
					

					SplitFile sp = new SplitFile();
					sp.splitFile(new File("Owner\\"+fname),5, 1024);
					
					
					System.out.println("FileNAME:"+fname);
					int len = fname.length();
					String fil = fname.substring(0, len-5);
					System.out.println(fil);
					
					System.out.println("File Splitted");
					
					
					MessageDigest md = MessageDigest.getInstance("SHA1");
					System.out.println("Hellllllll");
					
					FileInputStream fis1 = new FileInputStream("Owner\\"+fil+"1"+".txt");
					byte	 bs1[] = new byte[fis1.available()];
					fis1.read(bs1);
					String split1 = new String(bs1);
					fis1.close();
					
					FileInputStream fis11 = new FileInputStream("Owner\\"+fil+"1"+".txt");
					DigestInputStream dis1 = new DigestInputStream(fis11, md);
					BufferedInputStream bis1 = new BufferedInputStream(dis1);
		 
					//Read the bis so SHA1 is auto calculated at dis
					while (true) {
						int b1 = bis1.read();
						if (b1 == -1)
							break;
					}
		 
					BigInteger bi1 = new BigInteger(md.digest());
					String spl1 = bi1.toString();
					String	 h1 = bi1.toString(16);
					System.out.println(h1);
					
					FileInputStream fis2 = new FileInputStream("Owner\\"+fil+"2"+".txt");//C:\java\mtechproject\cloudcomputing\pra1.txt
					byte bs2[] = new byte[fis2.available()];
					fis2.read(bs2);
					String split2 = new String(bs2);
					FileInputStream fis22 = new FileInputStream("Owner\\"+fil+"2"+".txt");
		